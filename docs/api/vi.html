<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vi | Vitest</title>
    <meta name="description" content="A blazing fast unit test framework powered by Vite">
    <link rel="preload stylesheet" href="/assets/style.48b7780d.css" as="style">
    <script type="module" src="/assets/app.554aee49.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/assets/chunks/framework.cf42e605.js">
  <link rel="modulepreload" href="/assets/chunks/theme.af5939b4.js">
  <link rel="modulepreload" href="/assets/chunks/pwa.e4a05614.js">
  <link rel="modulepreload" href="/assets/api_vi.md.f371165e.lean.js">
  <meta name="theme-color" content="#729b1a">
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/logo.svg" type="image/svg+xml">
  <meta name="author" content="Anthony Fu, Vladimir, Ari Perkkiö, Patak, Joaquín Sánchez, Mohammad Bagher, Ivan Demchuk, Zixuan Chen, Yoho Po and Vitest contributors">
  <meta name="keywords" content="vitest, vite, test, coverage, snapshot, react, vue, preact, svelte, solid, lit, ruby, cypress, puppeteer, jsdom, happy-dom, test-runner, jest, typescript, esm, tinypool, tinyspy, node">
  <meta property="og:title" content="Vitest">
  <meta property="og:description" content="A blazing fast unit test framework powered by Vite">
  <meta property="og:url" content="https://vitest.dev/">
  <meta property="og:image" content="https://vitest.dev/og.png">
  <meta name="twitter:title" content="Vitest">
  <meta name="twitter:description" content="A blazing fast unit test framework powered by Vite">
  <meta name="twitter:image" content="https://vitest.dev/og.png">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="preload" as="style" onload="this.onload=null;this.rel=&#39;stylesheet&#39;" href="https://fonts.googleapis.com/css2?family=Readex+Pro:wght@200;400;600&amp;display=swap">
  <noscript><link rel="stylesheet" crossorigin="anonymous" href="https://fonts.googleapis.com/css2?family=Readex+Pro:wght@200;400;600&display=swap" /></noscript>
  <link rel="mask-icon" href="/logo.svg" color="#ffffff">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="prefetch" href="/logo.svg">
  <link rel="manifest" href="/manifest.webmanifest">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-2db02b50><!--[--><!--]--><!--[--><span tabindex="-1" data-v-5e70560c></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-5e70560c> Skip to content </a><!--]--><!----><header class="VPNav" data-v-2db02b50 data-v-fa675a10><div class="VPNavBar has-sidebar" data-v-fa675a10 data-v-6fa423e3><div class="container" data-v-6fa423e3><div class="title" data-v-6fa423e3><div class="VPNavBarTitle has-sidebar" data-v-6fa423e3 data-v-2bca2888><a class="title" href="/" data-v-2bca2888><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.svg" alt data-v-19e67cda><!--]--><!--[-->Vitest<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-6fa423e3><div class="curtain" data-v-6fa423e3></div><div class="content-body" data-v-6fa423e3><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-6fa423e3><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6fa423e3 data-v-179e9eb6><span id="main-nav-aria-label" class="visually-hidden" data-v-179e9eb6>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guide/" tabindex="0" data-v-179e9eb6 data-v-0d6c5a34><!--[-->Guide<!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/api/" tabindex="0" data-v-179e9eb6 data-v-0d6c5a34><!--[-->API<!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/config/" tabindex="0" data-v-179e9eb6 data-v-0d6c5a34><!--[-->Config<!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/advanced/api.html" tabindex="0" data-v-179e9eb6 data-v-0d6c5a34><!--[-->Advanced<!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-179e9eb6 data-v-e33b5fc4><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-e33b5fc4><span class="text" data-v-e33b5fc4><!----> v0.33.0 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-e33b5fc4><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-e33b5fc4><div class="VPMenu" data-v-e33b5fc4 data-v-23b32007><div class="items" data-v-23b32007><!--[--><!--[--><div class="VPMenuLink" data-v-23b32007 data-v-39eb710b><a class="VPLink link vp-external-link-icon" href="https://github.com/vitest-dev/vitest/releases" target="_blank" rel="noreferrer" data-v-39eb710b><!--[-->Release Notes <!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-23b32007 data-v-39eb710b><a class="VPLink link vp-external-link-icon" href="https://github.com/vitest-dev/vitest/blob/main/CONTRIBUTING.md" target="_blank" rel="noreferrer" data-v-39eb710b><!--[-->Contributing <!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-6fa423e3 data-v-036ea25f data-v-e33b5fc4><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-e33b5fc4><span class="text" data-v-e33b5fc4><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="option-icon" data-v-e33b5fc4><path d="M0 0h24v24H0z" fill="none"></path><path d=" M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z " class="css-c4d79v"></path></svg>  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-e33b5fc4><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-e33b5fc4><div class="VPMenu" data-v-e33b5fc4 data-v-23b32007><!----><!--[--><!--[--><div class="items" data-v-036ea25f><p class="title" data-v-036ea25f>English</p><!--[--><div class="VPMenuLink" data-v-036ea25f data-v-39eb710b><a class="VPLink link vp-external-link-icon" href="https://cn.vitest.dev/api/vi.html" target="_blank" rel="noreferrer" data-v-39eb710b><!--[-->简体中文<!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-6fa423e3 data-v-6bd0b601><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-6bd0b601 data-v-a5056307 data-v-1db13a0b><span class="check" data-v-1db13a0b><span class="icon" data-v-1db13a0b><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a5056307><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a5056307><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6fa423e3 data-v-6147ebb9 data-v-541548d6><!--[--><a class="VPSocialLink" href="https://elk.zone/m.webtoo.ls/@vitest" aria-label="mastodon" target="_blank" rel="noopener" data-v-541548d6 data-v-568b396c><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg></a><a class="VPSocialLink" href="https://twitter.com/vitest_dev" aria-label="twitter" target="_blank" rel="noopener" data-v-541548d6 data-v-568b396c><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg></a><a class="VPSocialLink" href="https://chat.vitest.dev" aria-label="discord" target="_blank" rel="noopener" data-v-541548d6 data-v-568b396c><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Discord</title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"/></svg></a><a class="VPSocialLink" href="https://github.com/vitest-dev/vitest" aria-label="github" target="_blank" rel="noopener" data-v-541548d6 data-v-568b396c><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6fa423e3 data-v-1ceaa38f data-v-e33b5fc4><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-e33b5fc4><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-e33b5fc4><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-e33b5fc4><div class="VPMenu" data-v-e33b5fc4 data-v-23b32007><!----><!--[--><!--[--><div class="group translations" data-v-1ceaa38f><p class="trans-title" data-v-1ceaa38f>English</p><!--[--><div class="VPMenuLink" data-v-1ceaa38f data-v-39eb710b><a class="VPLink link vp-external-link-icon" href="https://cn.vitest.dev/api/vi.html" target="_blank" rel="noreferrer" data-v-39eb710b><!--[-->简体中文<!--]--></a></div><!--]--></div><div class="group" data-v-1ceaa38f><div class="item appearance" data-v-1ceaa38f><p class="label" data-v-1ceaa38f>Appearance</p><div class="appearance-action" data-v-1ceaa38f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-1ceaa38f data-v-a5056307 data-v-1db13a0b><span class="check" data-v-1db13a0b><span class="icon" data-v-1db13a0b><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a5056307><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a5056307><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-1ceaa38f><div class="item social-links" data-v-1ceaa38f><div class="VPSocialLinks social-links-list" data-v-1ceaa38f data-v-541548d6><!--[--><a class="VPSocialLink" href="https://elk.zone/m.webtoo.ls/@vitest" aria-label="mastodon" target="_blank" rel="noopener" data-v-541548d6 data-v-568b396c><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg></a><a class="VPSocialLink" href="https://twitter.com/vitest_dev" aria-label="twitter" target="_blank" rel="noopener" data-v-541548d6 data-v-568b396c><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg></a><a class="VPSocialLink" href="https://chat.vitest.dev" aria-label="discord" target="_blank" rel="noopener" data-v-541548d6 data-v-568b396c><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Discord</title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"/></svg></a><a class="VPSocialLink" href="https://github.com/vitest-dev/vitest" aria-label="github" target="_blank" rel="noopener" data-v-541548d6 data-v-568b396c><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6fa423e3 data-v-4198bf04><span class="container" data-v-4198bf04><span class="top" data-v-4198bf04></span><span class="middle" data-v-4198bf04></span><span class="bottom" data-v-4198bf04></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-2db02b50 data-v-d5ce5fe0><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-d5ce5fe0><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-d5ce5fe0><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-d5ce5fe0>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-d5ce5fe0 data-v-e95b8ab7><button data-v-e95b8ab7>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-2db02b50 data-v-1915f304><div class="curtain" data-v-1915f304></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-1915f304><span class="visually-hidden" id="sidebar-aria-label" data-v-1915f304> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-1915f304><section class="VPSidebarItem level-0" data-v-1915f304 data-v-20b2bc21><div class="item" role="button" tabindex="0" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><h2 class="text" data-v-20b2bc21>Guide</h2><!----></div><div class="items" data-v-20b2bc21><!--[--><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/why.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Why Vitest</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/features.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Features</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/workspace.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Workspace</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/cli.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>CLI</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/filtering.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Test Filtering</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/coverage.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Coverage</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/snapshot.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Snapshot</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/mocking.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Mocking</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/testing-types.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Testing Types</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/ui.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Vitest UI</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/browser.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Browser Mode</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/in-source.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>In-source Testing</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/test-context.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Test Context</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/environment.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Environment</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/extending-matchers.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Extending Matchers</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/ide.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>IDE Integration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/debugging.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Debugging</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/comparisons.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Comparisons</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/migration.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Migration Guide</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/guide/common-errors.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Common Errors</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-1915f304><section class="VPSidebarItem level-0 has-active" data-v-1915f304 data-v-20b2bc21><div class="item" role="button" tabindex="0" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><h2 class="text" data-v-20b2bc21>API</h2><!----></div><div class="items" data-v-20b2bc21><!--[--><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/api/" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Test API Reference</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/api/mock.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Mock Functions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/api/vi.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Vi Utility</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/api/expect.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Expect</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/api/expect-typeof.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>ExpectTypeOf</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/api/assert-type.html" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>assertType</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-1915f304><section class="VPSidebarItem level-0" data-v-1915f304 data-v-20b2bc21><div class="item" role="button" tabindex="0" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><h2 class="text" data-v-20b2bc21>Config</h2><!----></div><div class="items" data-v-20b2bc21><!--[--><div class="VPSidebarItem level-1 is-link" data-v-20b2bc21 data-v-20b2bc21><div class="item" data-v-20b2bc21><div class="indicator" data-v-20b2bc21></div><a class="VPLink link link" href="/config/" data-v-20b2bc21><!--[--><p class="text" data-v-20b2bc21>Config Reference</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-2db02b50 data-v-3df90cdb><div class="VPDoc has-sidebar has-aside" data-v-3df90cdb data-v-c35479f9><!--[--><!--]--><div class="container" data-v-c35479f9><div class="aside" data-v-c35479f9><div class="aside-curtain" data-v-c35479f9></div><div class="aside-container" data-v-c35479f9><div class="aside-content" data-v-c35479f9><div class="VPDocAside" data-v-c35479f9 data-v-0b8e4320><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-0b8e4320 data-v-8abbf364><div class="content" data-v-8abbf364><div class="outline-marker" data-v-8abbf364></div><div class="outline-title" data-v-8abbf364>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-8abbf364><span class="visually-hidden" id="doc-outline-aria-label" data-v-8abbf364> Table of Contents for current page </span><ul class="root" data-v-8abbf364 data-v-ead8b7ff><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-0b8e4320></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-c35479f9><div class="content-container" data-v-c35479f9><!--[--><!--]--><!----><main class="main" data-v-c35479f9><div style="position:relative;" class="vp-doc _api_vi" data-v-c35479f9><div><h1 id="vi" tabindex="-1">Vi <a class="header-anchor" href="#vi" aria-label="Permalink to &quot;Vi&quot;">​</a></h1><p>Vitest provides utility functions to help you out through its <code>vi</code> helper. You can access it globally (when <a href="/config/#globals">globals configuration</a> is <strong>enabled</strong>), or import from <code>vitest</code>:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">vi</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">vitest</span><span style="color:#C98A7D99;">&#39;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">vi</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">vitest</span><span style="color:#B5695999;">&#39;</span></span></code></pre></div><h2 id="vi-advancetimersbytime" tabindex="-1">vi.advanceTimersByTime <a class="header-anchor" href="#vi-advancetimersbytime" aria-label="Permalink to &quot;vi.advanceTimersByTime&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>(ms: number) =&gt; Vitest</code></p><p>Works just like <code>runAllTimers</code>, but will end after passed milliseconds. For example this will log <code>1, 2, 3</code> and will not throw:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">let </span><span style="color:#BD976A;">i</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">0</span></span>
<span class="line"><span style="color:#80A665;">setInterval</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#CB7676;">++</span><span style="color:#BD976A;">i</span><span style="color:#666666;">),</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">50</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">advanceTimersByTime</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">150</span><span style="color:#666666;">)</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">let </span><span style="color:#B07D48;">i</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">0</span></span>
<span class="line"><span style="color:#59873A;">setInterval</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#AB5959;">++</span><span style="color:#B07D48;">i</span><span style="color:#999999;">),</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">50</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">advanceTimersByTime</span><span style="color:#999999;">(</span><span style="color:#2F798A;">150</span><span style="color:#999999;">)</span></span></code></pre></div></li></ul><h3 id="vi-advancetimersbytimeasync" tabindex="-1">vi.advanceTimersByTimeAsync <a class="header-anchor" href="#vi-advancetimersbytimeasync" aria-label="Permalink to &quot;vi.advanceTimersByTimeAsync&quot;">​</a></h3><ul><li><p><strong>Type:</strong> <code>(ms: number) =&gt; Promise&lt;Vitest&gt;</code></p><p>Works just like <code>runAllTimersAsync</code>, but will end after passed milliseconds. This will include asynchronously set timers. For example this will log <code>1, 2, 3</code> and will not throw:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">let </span><span style="color:#BD976A;">i</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">0</span></span>
<span class="line"><span style="color:#80A665;">setInterval</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Promise</span><span style="color:#666666;">.</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">().</span><span style="color:#80A665;">then</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#CB7676;">++</span><span style="color:#BD976A;">i</span><span style="color:#666666;">)),</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">50</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">await</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">advanceTimersByTimeAsync</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">150</span><span style="color:#666666;">)</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">let </span><span style="color:#B07D48;">i</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">0</span></span>
<span class="line"><span style="color:#59873A;">setInterval</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#998418;">Promise</span><span style="color:#999999;">.</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">().</span><span style="color:#59873A;">then</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#AB5959;">++</span><span style="color:#B07D48;">i</span><span style="color:#999999;">)),</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">50</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">await</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">advanceTimersByTimeAsync</span><span style="color:#999999;">(</span><span style="color:#2F798A;">150</span><span style="color:#999999;">)</span></span></code></pre></div></li></ul><h2 id="vi-advancetimerstonexttimer" tabindex="-1">vi.advanceTimersToNextTimer <a class="header-anchor" href="#vi-advancetimerstonexttimer" aria-label="Permalink to &quot;vi.advanceTimersToNextTimer&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>() =&gt; Vitest</code></p><p>Will call next available timer. Useful to make assertions between each timer call. You can chain call it to manage timers by yourself.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">let </span><span style="color:#BD976A;">i</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">0</span></span>
<span class="line"><span style="color:#80A665;">setInterval</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#CB7676;">++</span><span style="color:#BD976A;">i</span><span style="color:#666666;">),</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">50</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">advanceTimersToNextTimer</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// log 1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">.</span><span style="color:#80A665;">advanceTimersToNextTimer</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// log 2</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">.</span><span style="color:#80A665;">advanceTimersToNextTimer</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// log 3</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">let </span><span style="color:#B07D48;">i</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">0</span></span>
<span class="line"><span style="color:#59873A;">setInterval</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#AB5959;">++</span><span style="color:#B07D48;">i</span><span style="color:#999999;">),</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">50</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">advanceTimersToNextTimer</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// log 1</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">.</span><span style="color:#59873A;">advanceTimersToNextTimer</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// log 2</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">.</span><span style="color:#59873A;">advanceTimersToNextTimer</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// log 3</span></span></code></pre></div></li></ul><h3 id="vi-advancetimerstonexttimerasync" tabindex="-1">vi.advanceTimersToNextTimerAsync <a class="header-anchor" href="#vi-advancetimerstonexttimerasync" aria-label="Permalink to &quot;vi.advanceTimersToNextTimerAsync&quot;">​</a></h3><ul><li><p><strong>Type:</strong> <code>() =&gt; Promise&lt;Vitest&gt;</code></p><p>Will call next available timer even if it was set asynchronously. Useful to make assertions between each timer call. You can chain call it to manage timers by yourself.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">let </span><span style="color:#BD976A;">i</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">0</span></span>
<span class="line"><span style="color:#80A665;">setInterval</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Promise</span><span style="color:#666666;">.</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">().</span><span style="color:#80A665;">then</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#CB7676;">++</span><span style="color:#BD976A;">i</span><span style="color:#666666;">)),</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">50</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">advanceTimersToNextTimerAsync</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// log 1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">.</span><span style="color:#80A665;">advanceTimersToNextTimerAsync</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// log 2</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">.</span><span style="color:#80A665;">advanceTimersToNextTimerAsync</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// log 3</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">let </span><span style="color:#B07D48;">i</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">0</span></span>
<span class="line"><span style="color:#59873A;">setInterval</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#998418;">Promise</span><span style="color:#999999;">.</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">().</span><span style="color:#59873A;">then</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#AB5959;">++</span><span style="color:#B07D48;">i</span><span style="color:#999999;">)),</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">50</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">advanceTimersToNextTimerAsync</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// log 1</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">.</span><span style="color:#59873A;">advanceTimersToNextTimerAsync</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// log 2</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">.</span><span style="color:#59873A;">advanceTimersToNextTimerAsync</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// log 3</span></span></code></pre></div></li></ul><h2 id="vi-gettimercount" tabindex="-1">vi.getTimerCount <a class="header-anchor" href="#vi-gettimercount" aria-label="Permalink to &quot;vi.getTimerCount&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>() =&gt; number</code></p><p>Get the number of waiting timers.</p></li></ul><h2 id="vi-clearallmocks" tabindex="-1">vi.clearAllMocks <a class="header-anchor" href="#vi-clearallmocks" aria-label="Permalink to &quot;vi.clearAllMocks&quot;">​</a></h2><p>Will call <a href="/api/mock.html#mockclear"><code>.mockClear()</code></a> on all spies. This will clear mock history, but not reset its implementation to the default one.</p><h2 id="vi-clearalltimers" tabindex="-1">vi.clearAllTimers <a class="header-anchor" href="#vi-clearalltimers" aria-label="Permalink to &quot;vi.clearAllTimers&quot;">​</a></h2><p>Removes all timers that are scheduled to run. These timers will never run in the future.</p><h2 id="vi-dynamicimportsettled" tabindex="-1">vi.dynamicImportSettled <a class="header-anchor" href="#vi-dynamicimportsettled" aria-label="Permalink to &quot;vi.dynamicImportSettled&quot;">​</a></h2><p>Wait for all imports to load. Useful, if you have a synchronous call that starts importing a module, that you cannot wait otherwise.</p><h2 id="vi-fn" tabindex="-1">vi.fn <a class="header-anchor" href="#vi-fn" aria-label="Permalink to &quot;vi.fn&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>(fn?: Function) =&gt; CallableMockInstance</code></p><p>Creates a spy on a function, though can be initiated without one. Every time a function is invoked, it stores its call arguments, returns, and instances. Also, you can manipulate its behavior with <a href="/api/mock.html">methods</a>. If no function is given, mock will return <code>undefined</code>, when invoked.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">getApples</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">fn</span><span style="color:#666666;">(()</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">0</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">getApples</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">getApples</span><span style="color:#666666;">).</span><span style="color:#80A665;">toHaveBeenCalled</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">getApples</span><span style="color:#666666;">).</span><span style="color:#80A665;">toHaveReturnedWith</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">0</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">getApples</span><span style="color:#666666;">.</span><span style="color:#80A665;">mockReturnValueOnce</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">5</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">res</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#80A665;">getApples</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">res</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">5</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">getApples</span><span style="color:#666666;">).</span><span style="color:#80A665;">toHaveNthReturnedWith</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">2</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">5</span><span style="color:#666666;">)</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">getApples</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">fn</span><span style="color:#999999;">(()</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">0</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">getApples</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">getApples</span><span style="color:#999999;">).</span><span style="color:#59873A;">toHaveBeenCalled</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">getApples</span><span style="color:#999999;">).</span><span style="color:#59873A;">toHaveReturnedWith</span><span style="color:#999999;">(</span><span style="color:#2F798A;">0</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">getApples</span><span style="color:#999999;">.</span><span style="color:#59873A;">mockReturnValueOnce</span><span style="color:#999999;">(</span><span style="color:#2F798A;">5</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">res</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#59873A;">getApples</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">res</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#2F798A;">5</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">getApples</span><span style="color:#999999;">).</span><span style="color:#59873A;">toHaveNthReturnedWith</span><span style="color:#999999;">(</span><span style="color:#2F798A;">2</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">5</span><span style="color:#999999;">)</span></span></code></pre></div></li></ul><h2 id="vi-getmockedsystemtime" tabindex="-1">vi.getMockedSystemTime <a class="header-anchor" href="#vi-getmockedsystemtime" aria-label="Permalink to &quot;vi.getMockedSystemTime&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>() =&gt; Date | null</code></p><p>Returns mocked current date that was set using <code>setSystemTime</code>. If date is not mocked, will return <code>null</code>.</p></li></ul><h2 id="vi-getrealsystemtime" tabindex="-1">vi.getRealSystemTime <a class="header-anchor" href="#vi-getrealsystemtime" aria-label="Permalink to &quot;vi.getRealSystemTime&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>() =&gt; number</code></p><p>When using <code>vi.useFakeTimers</code>, <code>Date.now</code> calls are mocked. If you need to get real time in milliseconds, you can call this function.</p></li></ul><h2 id="vi-hoisted" tabindex="-1">vi.hoisted <a class="header-anchor" href="#vi-hoisted" aria-label="Permalink to &quot;vi.hoisted&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>&lt;T&gt;(factory: () =&gt; T) =&gt; T</code></p></li><li><p><strong>Version</strong>: Since Vitest 0.31.0</p><p>All static <code>import</code> statements in ES modules are hoisted to top of the file, so any code that is define before the imports will actually be executed after imports are evaluated.</p><p>Hovewer it can be useful to invoke some side effect like mocking dates before importing a module.</p><p>To bypass this limitation, you can rewrite static imports into dynamic ones like this:</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#DBD7CAEE;">callFunctionWithSideEffect()</span></span>
<span class="line"><span style="color:#FDAEB7;">- import { value } from &#39;./some/module.ts&#39;</span></span>
<span class="line"><span style="color:#85E89D;">+ const { value } = await import(&#39;./some/module.ts&#39;)</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#393A34;">callFunctionWithSideEffect()</span></span>
<span class="line"><span style="color:#B31D28;">- import { value } from &#39;./some/module.ts&#39;</span></span>
<span class="line"><span style="color:#22863A;">+ const { value } = await import(&#39;./some/module.ts&#39;)</span></span></code></pre></div><p>When running <code>vitest</code>, you can do this automatically by using <code>vi.hoisted</code> method.</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#FDAEB7;">- callFunctionWithSideEffect()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">import { value } from &#39;./some/module.ts&#39;</span></span>
<span class="line"><span style="color:#85E89D;">+ vi.hoisted(() =&gt; callFunctionWithSideEffect())</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B31D28;">- callFunctionWithSideEffect()</span></span>
<span class="line"><span style="color:#393A34;">import { value } from &#39;./some/module.ts&#39;</span></span>
<span class="line"><span style="color:#22863A;">+ vi.hoisted(() =&gt; callFunctionWithSideEffect())</span></span></code></pre></div><p>This method returns the value that was returned from the factory. You can use that value in your <code>vi.mock</code> factories if you need an easy access to locally defined variables:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">expect</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">vi</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">vitest</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">originalMethod</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./path/to/module.js</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#666666;">{</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">mockedMethod</span><span style="color:#CB7676;"> </span><span style="color:#666666;">}</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">hoisted</span><span style="color:#666666;">(()</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">  </span><span style="color:#4D9375;">return</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{ </span><span style="color:#B8A965;">mockedMethod</span><span style="color:#666666;">: </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">fn</span><span style="color:#666666;">() }</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">mock</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./path/to/module.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{ </span><span style="color:#B8A965;">originalMethod</span><span style="color:#666666;">: </span><span style="color:#BD976A;">mockedMethod</span><span style="color:#666666;"> }</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">mockedMethod</span><span style="color:#666666;">.</span><span style="color:#80A665;">mockReturnValue</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">100</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#80A665;">originalMethod</span><span style="color:#666666;">()).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">100</span><span style="color:#666666;">)</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">expect</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">vi</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">vitest</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">originalMethod</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./path/to/module.js</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#999999;">{</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">mockedMethod</span><span style="color:#AB5959;"> </span><span style="color:#999999;">}</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">hoisted</span><span style="color:#999999;">(()</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">  </span><span style="color:#1E754F;">return</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{ </span><span style="color:#998418;">mockedMethod</span><span style="color:#999999;">: </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">fn</span><span style="color:#999999;">() }</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">mock</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./path/to/module.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">{ </span><span style="color:#998418;">originalMethod</span><span style="color:#999999;">: </span><span style="color:#B07D48;">mockedMethod</span><span style="color:#999999;"> }</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">mockedMethod</span><span style="color:#999999;">.</span><span style="color:#59873A;">mockReturnValue</span><span style="color:#999999;">(</span><span style="color:#2F798A;">100</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#59873A;">originalMethod</span><span style="color:#999999;">()).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#2F798A;">100</span><span style="color:#999999;">)</span></span></code></pre></div></li></ul><h2 id="vi-mock" tabindex="-1">vi.mock <a class="header-anchor" href="#vi-mock" aria-label="Permalink to &quot;vi.mock&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>(path: string, factory?: () =&gt; unknown) =&gt; void</code></p><p>Substitutes all imported modules from provided <code>path</code> with another module. You can use configured Vite aliases inside a path. The call to <code>vi.mock</code> is hoisted, so it doesn&#39;t matter where you call it. It will always be executed before all imports. If you need to reference some variables outside of its scope, you can defined them inside <a href="/api/vi.html#vi-hoisted"><code>vi.hoisted</code></a> and reference inside <code>vi.mock</code>.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><code>vi.mock</code> works only for modules that were imported with the <code>import</code> keyword. It doesn&#39;t work with <code>require</code>.</p><p>Vitest statically analyzes your files to hoist <code>vi.mock</code>. It means that you cannot use <code>vi</code> that was not imported directly from <code>vitest</code> package (for example, from some utility file). To fix this, always use <code>vi.mock</code> with <code>vi</code> imported from <code>vitest</code>, or enable <a href="/config/#globals"><code>globals</code></a> config option.</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Mocking modules is not currently supported in the <a href="/guide/browser.html">browser mode</a>. You can track this feature in the GitHub <a href="https://github.com/vitest-dev/vitest/issues/3046">issue</a>.</p></div><p>If <code>factory</code> is defined, all imports will return its result. Vitest calls factory only once and caches result for all subsequent imports until <a href="#vi-unmock"><code>vi.unmock</code></a> or <a href="#vi-dounmock"><code>vi.doUnmock</code></a> is called.</p><p>Unlike in <code>jest</code>, the factory can be asynchronous, so you can use <a href="#vi-importactual"><code>vi.importActual</code></a> or a helper, received as the first argument, inside to get the original module.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">mock</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./path/to/module.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">importOriginal</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">mod</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4D9375;">await</span><span style="color:#CB7676;"> </span><span style="color:#80A665;">importOriginal</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    ...</span><span style="color:#BD976A;">mod</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// replace some exports</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#B8A965;">namedExport</span><span style="color:#666666;">: </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">fn</span><span style="color:#666666;">(),</span></span>
<span class="line"><span style="color:#666666;">  }</span></span>
<span class="line"><span style="color:#666666;">})</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">mock</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./path/to/module.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">async</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">importOriginal</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">mod</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#1E754F;">await</span><span style="color:#AB5959;"> </span><span style="color:#59873A;">importOriginal</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    ...</span><span style="color:#B07D48;">mod</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// replace some exports</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#998418;">namedExport</span><span style="color:#999999;">: </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">fn</span><span style="color:#999999;">(),</span></span>
<span class="line"><span style="color:#999999;">  }</span></span>
<span class="line"><span style="color:#999999;">})</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><code>vi.mock</code> is hoisted (in other words, <em>moved</em>) to <strong>top of the file</strong>. It means that whenever you write it (be it inside <code>beforeEach</code> or <code>test</code>), it will actually be called before that.</p><p>This also means that you cannot use any variables inside the factory that are defined outside the factory.</p><p>If you need to use variables inside the factory, try <a href="#vi-domock"><code>vi.doMock</code></a>. It works the same way but isn&#39;t hoisted. Beware that it only mocks subsequent imports.</p><p>You can also reference variables defined by <code>vi.hoisted</code> method if it was declared before <code>vi.mock</code>:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">namedExport</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./path/to/module.js</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">mocks</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">hoisted</span><span style="color:#666666;">(()</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">  </span><span style="color:#4D9375;">return</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#B8A965;">namedExport</span><span style="color:#666666;">: </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">fn</span><span style="color:#666666;">(),</span></span>
<span class="line"><span style="color:#666666;">  }</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">mock</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./path/to/module.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#B8A965;">namedExport</span><span style="color:#666666;">: </span><span style="color:#BD976A;">mocks</span><span style="color:#666666;">.</span><span style="color:#BD976A;">namedExport</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">  }</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">mocked</span><span style="color:#666666;">(</span><span style="color:#BD976A;">namedExport</span><span style="color:#666666;">).</span><span style="color:#80A665;">mockReturnValue</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">100</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#80A665;">namedExport</span><span style="color:#666666;">()).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">100</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">namedExport</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#BD976A;">mocks</span><span style="color:#666666;">.</span><span style="color:#BD976A;">namedExport</span><span style="color:#666666;">)</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">namedExport</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./path/to/module.js</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">mocks</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">hoisted</span><span style="color:#999999;">(()</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">  </span><span style="color:#1E754F;">return</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#998418;">namedExport</span><span style="color:#999999;">: </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">fn</span><span style="color:#999999;">(),</span></span>
<span class="line"><span style="color:#999999;">  }</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">mock</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./path/to/module.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#998418;">namedExport</span><span style="color:#999999;">: </span><span style="color:#B07D48;">mocks</span><span style="color:#999999;">.</span><span style="color:#B07D48;">namedExport</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">  }</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">mocked</span><span style="color:#999999;">(</span><span style="color:#B07D48;">namedExport</span><span style="color:#999999;">).</span><span style="color:#59873A;">mockReturnValue</span><span style="color:#999999;">(</span><span style="color:#2F798A;">100</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#59873A;">namedExport</span><span style="color:#999999;">()).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#2F798A;">100</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">namedExport</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B07D48;">mocks</span><span style="color:#999999;">.</span><span style="color:#B07D48;">namedExport</span><span style="color:#999999;">)</span></span></code></pre></div></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>If you are mocking a module with default export, you will need to provide a <code>default</code> key within the returned factory function object. This is an ES modules-specific caveat, therefore <code>jest</code> documentation may differ as <code>jest</code> uses CommonJS modules. For example,</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">mock</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./path/to/module.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#B8A965;">default</span><span style="color:#666666;">: { </span><span style="color:#B8A965;">myDefaultKey</span><span style="color:#666666;">: </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">fn</span><span style="color:#666666;">() },</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#B8A965;">namedExport</span><span style="color:#666666;">: </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">fn</span><span style="color:#666666;">(),</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// etc...</span></span>
<span class="line"><span style="color:#666666;">  }</span></span>
<span class="line"><span style="color:#666666;">})</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">mock</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./path/to/module.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#998418;">default</span><span style="color:#999999;">: { </span><span style="color:#998418;">myDefaultKey</span><span style="color:#999999;">: </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">fn</span><span style="color:#999999;">() },</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#998418;">namedExport</span><span style="color:#999999;">: </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">fn</span><span style="color:#999999;">(),</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// etc...</span></span>
<span class="line"><span style="color:#999999;">  }</span></span>
<span class="line"><span style="color:#999999;">})</span></span></code></pre></div></div><p>If there is a <code>__mocks__</code> folder alongside a file that you are mocking, and the factory is not provided, Vitest will try to find a file with the same name in the <code>__mocks__</code> subfolder and use it as an actual module. If you are mocking a dependency, Vitest will try to find a <code>__mocks__</code> folder in the <a href="/config/#root">root</a> of the project (default is <code>process.cwd()</code>). You can tell Vitest where the dependencies are located through the <a href="/config/#deps-moduledirectories">deps.moduleDirectories</a> config option.</p><p>For example, you have this file structure:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#dbd7caee;">- __mocks__</span></span>
<span class="line"><span style="color:#dbd7caee;">  - axios.js</span></span>
<span class="line"><span style="color:#dbd7caee;">- src</span></span>
<span class="line"><span style="color:#dbd7caee;">  __mocks__</span></span>
<span class="line"><span style="color:#dbd7caee;">    - increment.js</span></span>
<span class="line"><span style="color:#dbd7caee;">  - increment.js</span></span>
<span class="line"><span style="color:#dbd7caee;">- tests</span></span>
<span class="line"><span style="color:#dbd7caee;">  - increment.test.js</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#393a34;">- __mocks__</span></span>
<span class="line"><span style="color:#393a34;">  - axios.js</span></span>
<span class="line"><span style="color:#393a34;">- src</span></span>
<span class="line"><span style="color:#393a34;">  __mocks__</span></span>
<span class="line"><span style="color:#393a34;">    - increment.js</span></span>
<span class="line"><span style="color:#393a34;">  - increment.js</span></span>
<span class="line"><span style="color:#393a34;">- tests</span></span>
<span class="line"><span style="color:#393a34;">  - increment.test.js</span></span></code></pre></div><p>If you call <code>vi.mock</code> in a test file without a factory provided, it will find a file in the <code>__mocks__</code> folder to use as a module:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// increment.test.js</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">vi</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">vitest</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// axios is a default export from `__mocks__/axios.js`</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">axios</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">axios</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// increment is a named export from `src/__mocks__/increment.js`</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">increment</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">../increment.js</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">mock</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">axios</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">mock</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">../increment.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">axios</span><span style="color:#666666;">.</span><span style="color:#80A665;">get</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">`</span><span style="color:#C98A7D;">/apples/</span><span style="color:#666666;">${</span><span style="color:#80A665;">increment</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span><span style="color:#666666;">}</span><span style="color:#C98A7D99;">`</span><span style="color:#666666;">)</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// increment.test.js</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">vi</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">vitest</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// axios is a default export from `__mocks__/axios.js`</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">axios</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">axios</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// increment is a named export from `src/__mocks__/increment.js`</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">increment</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">../increment.js</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">mock</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">axios</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">mock</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">../increment.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">axios</span><span style="color:#999999;">.</span><span style="color:#59873A;">get</span><span style="color:#999999;">(</span><span style="color:#B5695999;">`</span><span style="color:#B56959;">/apples/</span><span style="color:#999999;">${</span><span style="color:#59873A;">increment</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span><span style="color:#999999;">}</span><span style="color:#B5695999;">`</span><span style="color:#999999;">)</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Beware that if you don&#39;t call <code>vi.mock</code>, modules <strong>are not</strong> mocked automatically. To replicate Jest&#39;s automocking behaviour, you can call <code>vi.mock</code> for each required module inside <a href="/config/#setupfiles"><code>setupFiles</code></a>.</p></div><p>If there is no <code>__mocks__</code> folder or a factory provided, Vitest will import the original module and auto-mock all its exports. For the rules applied, see <a href="/guide/mocking.html#automocking-algorithm">algorithm</a>.</p></li></ul><h2 id="vi-domock" tabindex="-1">vi.doMock <a class="header-anchor" href="#vi-domock" aria-label="Permalink to &quot;vi.doMock&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>(path: string, factory?: () =&gt; unknown) =&gt; void</code></p><p>The same as <a href="#vi-mock"><code>vi.mock</code></a>, but it&#39;s not hoisted at the top of the file, so you can reference variables in the global file scope. The next import of the module will be mocked. This will not mock modules that were imported before this was called.</p></li></ul><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// ./increment.js</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">increment</span><span style="color:#666666;">(</span><span style="color:#BD976A;">number</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">number</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// ./increment.js</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">increment</span><span style="color:#999999;">(</span><span style="color:#B07D48;">number</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">number</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">beforeEach</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">test</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">vitest</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">increment</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./increment.js</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// the module is not mocked, because vi.doMock is not called yet</span></span>
<span class="line"><span style="color:#80A665;">increment</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">let </span><span style="color:#BD976A;">mockedIncrement</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">beforeEach</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// you can access variables inside a factory</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">doMock</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./increment.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">({ </span><span style="color:#80A665;">increment</span><span style="color:#666666;">: () =&gt; </span><span style="color:#CB7676;">++</span><span style="color:#BD976A;">mockedIncrement</span><span style="color:#666666;"> }))</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">importing the next module imports mocked one</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// original import WAS NOT MOCKED, because vi.doMock is evaluated AFTER imports</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#80A665;">increment</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">2</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#666666;">{</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">increment</span><span style="color:#666666;">:</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">mockedIncrement</span><span style="color:#CB7676;"> </span><span style="color:#666666;">}</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4D9375;">await</span><span style="color:#CB7676;"> import</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./increment.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// new import returns mocked module</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#80A665;">mockedIncrement</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">101</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#80A665;">mockedIncrement</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">102</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#80A665;">mockedIncrement</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">103</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">})</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">beforeEach</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">test</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">vitest</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">increment</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./increment.js</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// the module is not mocked, because vi.doMock is not called yet</span></span>
<span class="line"><span style="color:#59873A;">increment</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">let </span><span style="color:#B07D48;">mockedIncrement</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">beforeEach</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// you can access variables inside a factory</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">doMock</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./increment.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">({ </span><span style="color:#59873A;">increment</span><span style="color:#999999;">: () =&gt; </span><span style="color:#AB5959;">++</span><span style="color:#B07D48;">mockedIncrement</span><span style="color:#999999;"> }))</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">importing the next module imports mocked one</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">async</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// original import WAS NOT MOCKED, because vi.doMock is evaluated AFTER imports</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#59873A;">increment</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#2F798A;">2</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#999999;">{</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">increment</span><span style="color:#999999;">:</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">mockedIncrement</span><span style="color:#AB5959;"> </span><span style="color:#999999;">}</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#1E754F;">await</span><span style="color:#AB5959;"> import</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./increment.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// new import returns mocked module</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#59873A;">mockedIncrement</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#2F798A;">101</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#59873A;">mockedIncrement</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#2F798A;">102</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#59873A;">mockedIncrement</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#2F798A;">103</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">})</span></span></code></pre></div><h2 id="vi-mocked" tabindex="-1">vi.mocked <a class="header-anchor" href="#vi-mocked" aria-label="Permalink to &quot;vi.mocked&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>&lt;T&gt;(obj: T, deep?: boolean) =&gt; MaybeMockedDeep&lt;T&gt;</code></p></li><li><p><strong>Type</strong>: <code>&lt;T&gt;(obj: T, options?: { partial?: boolean; deep?: boolean }) =&gt; MaybePartiallyMockedDeep&lt;T&gt;</code></p><p>Type helper for TypeScript. In reality just returns the object that was passed.</p><p>When <code>partial</code> is <code>true</code> it will expect a <code>Partial&lt;T&gt;</code> as a return value.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">example</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./example.js</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">mock</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./example.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">1+1 equals 2</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">mocked</span><span style="color:#666666;">(</span><span style="color:#BD976A;">example</span><span style="color:#666666;">.</span><span style="color:#BD976A;">calc</span><span style="color:#666666;">).</span><span style="color:#80A665;">mockRestore</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">res</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">example</span><span style="color:#666666;">.</span><span style="color:#80A665;">calc</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">,</span><span style="color:#CB7676;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">+</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">res</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">2</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">})</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">example</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./example.js</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">mock</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./example.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">1+1 equals 2</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">async</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">mocked</span><span style="color:#999999;">(</span><span style="color:#B07D48;">example</span><span style="color:#999999;">.</span><span style="color:#B07D48;">calc</span><span style="color:#999999;">).</span><span style="color:#59873A;">mockRestore</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">res</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">example</span><span style="color:#999999;">.</span><span style="color:#59873A;">calc</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">,</span><span style="color:#AB5959;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">+</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">res</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#2F798A;">2</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">})</span></span></code></pre></div></li></ul><h2 id="vi-importactual" tabindex="-1">vi.importActual <a class="header-anchor" href="#vi-importactual" aria-label="Permalink to &quot;vi.importActual&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>&lt;T&gt;(path: string) =&gt; Promise&lt;T&gt;</code></p><p>Imports module, bypassing all checks if it should be mocked. Can be useful if you want to mock module partially.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">mock</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./example.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">axios</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4D9375;">await</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">importActual</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./example.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{ ...</span><span style="color:#BD976A;">axios</span><span style="color:#666666;">, </span><span style="color:#B8A965;">get</span><span style="color:#666666;">: </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">fn</span><span style="color:#666666;">() }</span></span>
<span class="line"><span style="color:#666666;">})</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">mock</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./example.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">async</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">axios</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#1E754F;">await</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">importActual</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./example.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">{ ...</span><span style="color:#B07D48;">axios</span><span style="color:#999999;">, </span><span style="color:#998418;">get</span><span style="color:#999999;">: </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">fn</span><span style="color:#999999;">() }</span></span>
<span class="line"><span style="color:#999999;">})</span></span></code></pre></div></li></ul><h2 id="vi-importmock" tabindex="-1">vi.importMock <a class="header-anchor" href="#vi-importmock" aria-label="Permalink to &quot;vi.importMock&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>&lt;T&gt;(path: string) =&gt; Promise&lt;MaybeMockedDeep&lt;T&gt;&gt;</code></p><p>Imports a module with all of its properties (including nested properties) mocked. Follows the same rules that <a href="#vi-mock"><code>vi.mock</code></a> follows. For the rules applied, see <a href="/guide/mocking.html#automocking-algorithm">algorithm</a>.</p></li></ul><h2 id="vi-resetallmocks" tabindex="-1">vi.resetAllMocks <a class="header-anchor" href="#vi-resetallmocks" aria-label="Permalink to &quot;vi.resetAllMocks&quot;">​</a></h2><p>Will call <a href="/api/mock.html#mockreset"><code>.mockReset()</code></a> on all spies. This will clear mock history and reset its implementation to an empty function (will return <code>undefined</code>).</p><h2 id="vi-resetconfig" tabindex="-1">vi.resetConfig <a class="header-anchor" href="#vi-resetconfig" aria-label="Permalink to &quot;vi.resetConfig&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>RuntimeConfig</code></p><p>If <a href="#vi-setconfig"><code>vi.setConfig</code></a> was called before, this will reset config to the original state.</p></li></ul><h2 id="vi-resetmodules" tabindex="-1">vi.resetModules <a class="header-anchor" href="#vi-resetmodules" aria-label="Permalink to &quot;vi.resetModules&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>() =&gt; Vitest</code></p><p>Resets modules registry by clearing cache of all modules. This allows modules to be reevaluated when reimported. Top-level imports cannot be reevaluated. Might be useful to isolate modules where local state conflicts between tests.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">vi</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">vitest</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">data</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./data.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// Will not get reevaluated beforeEach test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">beforeEach</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">resetModules</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">change state</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">mod</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4D9375;">await</span><span style="color:#CB7676;"> import</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./some/path.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span><span style="color:#CB7676;"> </span><span style="color:#758575DD;">// Will get reevaluated</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">mod</span><span style="color:#666666;">.</span><span style="color:#80A665;">changeLocalState</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">new value</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">mod</span><span style="color:#666666;">.</span><span style="color:#80A665;">getLocalState</span><span style="color:#666666;">()).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">new value</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">module has old state</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">mod</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4D9375;">await</span><span style="color:#CB7676;"> import</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./some/path.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span><span style="color:#CB7676;"> </span><span style="color:#758575DD;">// Will get reevaluated</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">mod</span><span style="color:#666666;">.</span><span style="color:#80A665;">getLocalState</span><span style="color:#666666;">()).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">old value</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">})</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">vi</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">vitest</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">data</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./data.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// Will not get reevaluated beforeEach test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">beforeEach</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">resetModules</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">change state</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">async</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">mod</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#1E754F;">await</span><span style="color:#AB5959;"> import</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./some/path.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span><span style="color:#AB5959;"> </span><span style="color:#A0ADA0;">// Will get reevaluated</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">mod</span><span style="color:#999999;">.</span><span style="color:#59873A;">changeLocalState</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">new value</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">mod</span><span style="color:#999999;">.</span><span style="color:#59873A;">getLocalState</span><span style="color:#999999;">()).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">new value</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">module has old state</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">async</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">mod</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#1E754F;">await</span><span style="color:#AB5959;"> import</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./some/path.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span><span style="color:#AB5959;"> </span><span style="color:#A0ADA0;">// Will get reevaluated</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">mod</span><span style="color:#999999;">.</span><span style="color:#59873A;">getLocalState</span><span style="color:#999999;">()).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">old value</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">})</span></span></code></pre></div></li></ul><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Does not reset mocks registry. To clear mocks registry, use <a href="#vi-unmock"><code>vi.unmock</code></a> or <a href="#vi-dounmock"><code>vi.doUnmock</code></a>.</p></div><h2 id="vi-restoreallmocks" tabindex="-1">vi.restoreAllMocks <a class="header-anchor" href="#vi-restoreallmocks" aria-label="Permalink to &quot;vi.restoreAllMocks&quot;">​</a></h2><p>Will call <a href="/api/mock.html#mockrestore"><code>.mockRestore()</code></a> on all spies. This will clear mock history and reset its implementation to the original one.</p><h2 id="vi-restorecurrentdate" tabindex="-1">vi.restoreCurrentDate <a class="header-anchor" href="#vi-restorecurrentdate" aria-label="Permalink to &quot;vi.restoreCurrentDate&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>() =&gt; void</code></p><p>Restores <code>Date</code> back to its native implementation.</p></li></ul><h2 id="vi-stubenv" tabindex="-1">vi.stubEnv <a class="header-anchor" href="#vi-stubenv" aria-label="Permalink to &quot;vi.stubEnv&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>(name: string, value: string) =&gt; Vitest</code></p></li><li><p><strong>Version:</strong> Since Vitest 0.26.0</p><p>Changes the value of environmental variable on <code>p<wbr>rocess.env</code> and <code>i<wbr>mport.meta.env</code>. You can restore its value by calling <code>vi.unstubAllEnvs</code>.</p></li></ul><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">vi</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">vitest</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// `p<wbr>rocess.env.NODE_ENV` and `i<wbr>mport.meta.env.NODE_ENV`</span></span>
<span class="line"><span style="color:#758575DD;">// are &quot;development&quot; before calling &quot;vi.stubEnv&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">stubEnv</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">NODE_ENV</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">production</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">process</span><span style="color:#666666;">.</span><span style="color:#BD976A;">env</span><span style="color:#666666;">.</span><span style="color:#BD976A;">NODE_ENV</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">production</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#666666;">.</span><span style="color:#B8A965;">meta</span><span style="color:#666666;">.</span><span style="color:#BD976A;">env</span><span style="color:#666666;">.</span><span style="color:#BD976A;">NODE_ENV</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">production</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#758575DD;">// doesn&#39;t change other envs</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#666666;">.</span><span style="color:#B8A965;">meta</span><span style="color:#666666;">.</span><span style="color:#BD976A;">env</span><span style="color:#666666;">.</span><span style="color:#BD976A;">MODE</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">development</span><span style="color:#C98A7D99;">&#39;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">vi</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">vitest</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// `p<wbr>rocess.env.NODE_ENV` and `i<wbr>mport.meta.env.NODE_ENV`</span></span>
<span class="line"><span style="color:#A0ADA0;">// are &quot;development&quot; before calling &quot;vi.stubEnv&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">stubEnv</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">NODE_ENV</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">production</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">process</span><span style="color:#999999;">.</span><span style="color:#B07D48;">env</span><span style="color:#999999;">.</span><span style="color:#B07D48;">NODE_ENV</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">production</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#999999;">.</span><span style="color:#998418;">meta</span><span style="color:#999999;">.</span><span style="color:#B07D48;">env</span><span style="color:#999999;">.</span><span style="color:#B07D48;">NODE_ENV</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">production</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#A0ADA0;">// doesn&#39;t change other envs</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#999999;">.</span><span style="color:#998418;">meta</span><span style="color:#999999;">.</span><span style="color:#B07D48;">env</span><span style="color:#999999;">.</span><span style="color:#B07D48;">MODE</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">development</span><span style="color:#B5695999;">&#39;</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You can also change the value by simply assigning it, but you won&#39;t be able to use <code>vi.unstubAllEnvs</code> to restore previous value:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#666666;">.</span><span style="color:#B8A965;">meta</span><span style="color:#666666;">.</span><span style="color:#BD976A;">env</span><span style="color:#666666;">.</span><span style="color:#BD976A;">MODE</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">test</span><span style="color:#C98A7D99;">&#39;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#999999;">.</span><span style="color:#998418;">meta</span><span style="color:#999999;">.</span><span style="color:#B07D48;">env</span><span style="color:#999999;">.</span><span style="color:#B07D48;">MODE</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">test</span><span style="color:#B5695999;">&#39;</span></span></code></pre></div></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Vitest transforms all <code>i<wbr>mport.meta.env</code> calls into <code>p<wbr>rocess.env</code>, so they can be easily changed at runtime. Node.js only supports string values as env parameters, while Vite supports several built-in envs as boolean (namely, <code>SSR</code>, <code>DEV</code>, <code>PROD</code>). To mimic Vite, set &quot;truthy&quot; values as env: <code>&#39;&#39;</code> instead of <code>false</code>, and <code>&#39;1&#39;</code> instead of <code>true</code>.</p><p>But beware that you cannot rely on <code>i<wbr>mport.meta.env.DEV === false</code> in this case. Use <code>!i<wbr>mport.meta.env.DEV</code>. This also affects simple assigning, not just <code>vi.stubEnv</code> method.</p></div><h2 id="vi-unstuballenvs" tabindex="-1">vi.unstubAllEnvs <a class="header-anchor" href="#vi-unstuballenvs" aria-label="Permalink to &quot;vi.unstubAllEnvs&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>() =&gt; Vitest</code></p></li><li><p><strong>Version:</strong> Since Vitest 0.26.0</p><p>Restores all <code>i<wbr>mport.meta.env</code> and <code>p<wbr>rocess.env</code> values that were changed with <code>vi.stubEnv</code>. When it&#39;s called for the first time, Vitest remembers the original value and will store it, until <code>unstubAllEnvs</code> is called again.</p></li></ul><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">vi</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">vitest</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// `p<wbr>rocess.env.NODE_ENV` and `i<wbr>mport.meta.env.NODE_ENV`</span></span>
<span class="line"><span style="color:#758575DD;">// are &quot;development&quot; before calling stubEnv</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">stubEnv</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">NODE_ENV</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">production</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">process</span><span style="color:#666666;">.</span><span style="color:#BD976A;">env</span><span style="color:#666666;">.</span><span style="color:#BD976A;">NODE_ENV</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">production</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#666666;">.</span><span style="color:#B8A965;">meta</span><span style="color:#666666;">.</span><span style="color:#BD976A;">env</span><span style="color:#666666;">.</span><span style="color:#BD976A;">NODE_ENV</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">production</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">stubEnv</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">NODE_ENV</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">staging</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">process</span><span style="color:#666666;">.</span><span style="color:#BD976A;">env</span><span style="color:#666666;">.</span><span style="color:#BD976A;">NODE_ENV</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">staging</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#666666;">.</span><span style="color:#B8A965;">meta</span><span style="color:#666666;">.</span><span style="color:#BD976A;">env</span><span style="color:#666666;">.</span><span style="color:#BD976A;">NODE_ENV</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">staging</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">unstubAllEnvs</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// restores to the value that were stored before the first &quot;stubEnv&quot; call</span></span>
<span class="line"><span style="color:#BD976A;">process</span><span style="color:#666666;">.</span><span style="color:#BD976A;">env</span><span style="color:#666666;">.</span><span style="color:#BD976A;">NODE_ENV</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">development</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#666666;">.</span><span style="color:#B8A965;">meta</span><span style="color:#666666;">.</span><span style="color:#BD976A;">env</span><span style="color:#666666;">.</span><span style="color:#BD976A;">NODE_ENV</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">development</span><span style="color:#C98A7D99;">&#39;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">vi</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">vitest</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// `p<wbr>rocess.env.NODE_ENV` and `i<wbr>mport.meta.env.NODE_ENV`</span></span>
<span class="line"><span style="color:#A0ADA0;">// are &quot;development&quot; before calling stubEnv</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">stubEnv</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">NODE_ENV</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">production</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">process</span><span style="color:#999999;">.</span><span style="color:#B07D48;">env</span><span style="color:#999999;">.</span><span style="color:#B07D48;">NODE_ENV</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">production</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#999999;">.</span><span style="color:#998418;">meta</span><span style="color:#999999;">.</span><span style="color:#B07D48;">env</span><span style="color:#999999;">.</span><span style="color:#B07D48;">NODE_ENV</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">production</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">stubEnv</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">NODE_ENV</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">staging</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">process</span><span style="color:#999999;">.</span><span style="color:#B07D48;">env</span><span style="color:#999999;">.</span><span style="color:#B07D48;">NODE_ENV</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">staging</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#999999;">.</span><span style="color:#998418;">meta</span><span style="color:#999999;">.</span><span style="color:#B07D48;">env</span><span style="color:#999999;">.</span><span style="color:#B07D48;">NODE_ENV</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">staging</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">unstubAllEnvs</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// restores to the value that were stored before the first &quot;stubEnv&quot; call</span></span>
<span class="line"><span style="color:#B07D48;">process</span><span style="color:#999999;">.</span><span style="color:#B07D48;">env</span><span style="color:#999999;">.</span><span style="color:#B07D48;">NODE_ENV</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">development</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#999999;">.</span><span style="color:#998418;">meta</span><span style="color:#999999;">.</span><span style="color:#B07D48;">env</span><span style="color:#999999;">.</span><span style="color:#B07D48;">NODE_ENV</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">development</span><span style="color:#B5695999;">&#39;</span></span></code></pre></div><h2 id="vi-stubglobal" tabindex="-1">vi.stubGlobal <a class="header-anchor" href="#vi-stubglobal" aria-label="Permalink to &quot;vi.stubGlobal&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>(name: string | number | symbol, value: unknown) =&gt; Vitest</code></p><p>Changes the value of global variable. You can restore its original value by calling <code>vi.unstubAllGlobals</code>.</p></li></ul><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">vi</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">vitest</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// `innerWidth` is &quot;0&quot; before calling stubGlobal</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">stubGlobal</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">innerWidth</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">innerWidth</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span></span>
<span class="line"><span style="color:#BD976A;">globalThis</span><span style="color:#666666;">.</span><span style="color:#BD976A;">innerWidth</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span></span>
<span class="line"><span style="color:#758575DD;">// if you are using jsdom or happy-dom</span></span>
<span class="line"><span style="color:#BD976A;">window</span><span style="color:#666666;">.</span><span style="color:#BD976A;">innerWidth</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">vi</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">vitest</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// `innerWidth` is &quot;0&quot; before calling stubGlobal</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">stubGlobal</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">innerWidth</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">innerWidth</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span></span>
<span class="line"><span style="color:#B07D48;">globalThis</span><span style="color:#999999;">.</span><span style="color:#B07D48;">innerWidth</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span></span>
<span class="line"><span style="color:#A0ADA0;">// if you are using jsdom or happy-dom</span></span>
<span class="line"><span style="color:#B07D48;">window</span><span style="color:#999999;">.</span><span style="color:#B07D48;">innerWidth</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You can also change the value by simply assigning it to <code>globalThis</code> or <code>window</code> (if you are using <code>jsdom</code> or <code>happy-dom</code> environment), but you won&#39;t be able to use <code>vi.unstubAllGlobals</code> to restore original value:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#BD976A;">globalThis</span><span style="color:#666666;">.</span><span style="color:#BD976A;">innerWidth</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span></span>
<span class="line"><span style="color:#758575DD;">// if you are using jsdom or happy-dom</span></span>
<span class="line"><span style="color:#BD976A;">window</span><span style="color:#666666;">.</span><span style="color:#BD976A;">innerWidth</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B07D48;">globalThis</span><span style="color:#999999;">.</span><span style="color:#B07D48;">innerWidth</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span></span>
<span class="line"><span style="color:#A0ADA0;">// if you are using jsdom or happy-dom</span></span>
<span class="line"><span style="color:#B07D48;">window</span><span style="color:#999999;">.</span><span style="color:#B07D48;">innerWidth</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span></span></code></pre></div></div><h2 id="vi-unstuballglobals" tabindex="-1">vi.unstubAllGlobals <a class="header-anchor" href="#vi-unstuballglobals" aria-label="Permalink to &quot;vi.unstubAllGlobals&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>() =&gt; Vitest</code></p></li><li><p><strong>Version:</strong> Since Vitest 0.26.0</p><p>Restores all global values on <code>globalThis</code>/<code>global</code> (and <code>window</code>/<code>top</code>/<code>self</code>/<code>parent</code>, if you are using <code>jsdom</code> or <code>happy-dom</code> environment) that were changed with <code>vi.stubGlobal</code>. When it&#39;s called for the first time, Vitest remembers the original value and will store it, until <code>unstubAllGlobals</code> is called again.</p></li></ul><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">vi</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">vitest</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">Mock</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">fn</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// IntersectionObserver is &quot;undefined&quot; before calling &quot;stubGlobal&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">stubGlobal</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">IntersectionObserver</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Mock</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">IntersectionObserver</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Mock</span></span>
<span class="line"><span style="color:#BD976A;">global</span><span style="color:#666666;">.</span><span style="color:#BD976A;">IntersectionObserver</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Mock</span></span>
<span class="line"><span style="color:#BD976A;">globalThis</span><span style="color:#666666;">.</span><span style="color:#BD976A;">IntersectionObserver</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Mock</span></span>
<span class="line"><span style="color:#758575DD;">// if you are using jsdom or happy-dom</span></span>
<span class="line"><span style="color:#BD976A;">window</span><span style="color:#666666;">.</span><span style="color:#BD976A;">IntersectionObserver</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Mock</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">unstubAllGlobals</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">globalThis</span><span style="color:#666666;">.</span><span style="color:#BD976A;">IntersectionObserver</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">undefined</span></span>
<span class="line"><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">IntersectionObserver</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">in</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">globalThis</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">false</span></span>
<span class="line"><span style="color:#758575DD;">// throws ReferenceError, because it&#39;s not defined</span></span>
<span class="line"><span style="color:#BD976A;">IntersectionObserver</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">undefined</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">vi</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">vitest</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">Mock</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">fn</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// IntersectionObserver is &quot;undefined&quot; before calling &quot;stubGlobal&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">stubGlobal</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">IntersectionObserver</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Mock</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">IntersectionObserver</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Mock</span></span>
<span class="line"><span style="color:#B07D48;">global</span><span style="color:#999999;">.</span><span style="color:#B07D48;">IntersectionObserver</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Mock</span></span>
<span class="line"><span style="color:#B07D48;">globalThis</span><span style="color:#999999;">.</span><span style="color:#B07D48;">IntersectionObserver</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Mock</span></span>
<span class="line"><span style="color:#A0ADA0;">// if you are using jsdom or happy-dom</span></span>
<span class="line"><span style="color:#B07D48;">window</span><span style="color:#999999;">.</span><span style="color:#B07D48;">IntersectionObserver</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Mock</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">unstubAllGlobals</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">globalThis</span><span style="color:#999999;">.</span><span style="color:#B07D48;">IntersectionObserver</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">undefined</span></span>
<span class="line"><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">IntersectionObserver</span><span style="color:#B5695999;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">in</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">globalThis</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">false</span></span>
<span class="line"><span style="color:#A0ADA0;">// throws ReferenceError, because it&#39;s not defined</span></span>
<span class="line"><span style="color:#B07D48;">IntersectionObserver</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">undefined</span></span></code></pre></div><h2 id="vi-runallticks" tabindex="-1">vi.runAllTicks <a class="header-anchor" href="#vi-runallticks" aria-label="Permalink to &quot;vi.runAllTicks&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>() =&gt; Vitest</code></p><p>Calls every microtask that was queued by <code>process.nextTick</code>. This will also run all microtasks scheduled by themselves.</p></li></ul><h2 id="vi-runalltimers" tabindex="-1">vi.runAllTimers <a class="header-anchor" href="#vi-runalltimers" aria-label="Permalink to &quot;vi.runAllTimers&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>() =&gt; Vitest</code></p><p>This method will invoke every initiated timer until the timers queue is empty. It means that every timer called during <code>runAllTimers</code> will be fired. If you have an infinite interval, it will throw after 10 000 tries. For example this will log <code>1, 2, 3</code>:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">let </span><span style="color:#BD976A;">i</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">0</span></span>
<span class="line"><span style="color:#80A665;">setTimeout</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#CB7676;">++</span><span style="color:#BD976A;">i</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">interval</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#80A665;">setInterval</span><span style="color:#666666;">(()</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#CB7676;">++</span><span style="color:#BD976A;">i</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#CB7676;">  </span><span style="color:#4D9375;">if</span><span style="color:#CB7676;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">i</span><span style="color:#CB7676;"> === </span><span style="color:#4C9A91;">3</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#CB7676;">    </span><span style="color:#80A665;">clearInterval</span><span style="color:#666666;">(</span><span style="color:#BD976A;">interval</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">},</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">50</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">runAllTimers</span><span style="color:#666666;">()</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">let </span><span style="color:#B07D48;">i</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">0</span></span>
<span class="line"><span style="color:#59873A;">setTimeout</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#AB5959;">++</span><span style="color:#B07D48;">i</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">interval</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#59873A;">setInterval</span><span style="color:#999999;">(()</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#AB5959;">++</span><span style="color:#B07D48;">i</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#AB5959;">  </span><span style="color:#1E754F;">if</span><span style="color:#AB5959;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">i</span><span style="color:#AB5959;"> === </span><span style="color:#2F798A;">3</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#AB5959;">    </span><span style="color:#59873A;">clearInterval</span><span style="color:#999999;">(</span><span style="color:#B07D48;">interval</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">},</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">50</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">runAllTimers</span><span style="color:#999999;">()</span></span></code></pre></div></li></ul><h3 id="vi-runalltimersasync" tabindex="-1">vi.runAllTimersAsync <a class="header-anchor" href="#vi-runalltimersasync" aria-label="Permalink to &quot;vi.runAllTimersAsync&quot;">​</a></h3><ul><li><p><strong>Type:</strong> <code>() =&gt; Promise&lt;Vitest&gt;</code></p><p>This method will asynchronously invoke every initiated timer until the timers queue is empty. It means that every timer called during <code>runAllTimersAsync</code> will be fired even asynchronous timers. If you have an infinite interval, it will throw after 10 000 tries. For example this will log <code>result</code>:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#80A665;">setTimeout</span><span style="color:#666666;">(</span><span style="color:#CB7676;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#4D9375;">await</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Promise</span><span style="color:#666666;">.</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">result</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#666666;">},</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">await</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">runAllTimersAsync</span><span style="color:#666666;">()</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">setTimeout</span><span style="color:#999999;">(</span><span style="color:#AB5959;">async</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#1E754F;">await</span><span style="color:#393A34;"> </span><span style="color:#998418;">Promise</span><span style="color:#999999;">.</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">result</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">await</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">runAllTimersAsync</span><span style="color:#999999;">()</span></span></code></pre></div></li></ul><h2 id="vi-runonlypendingtimers" tabindex="-1">vi.runOnlyPendingTimers <a class="header-anchor" href="#vi-runonlypendingtimers" aria-label="Permalink to &quot;vi.runOnlyPendingTimers&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>() =&gt; Vitest</code></p><p>This method will call every timer that was initiated after <code>vi.useFakeTimers()</code> call. It will not fire any timer that was initiated during its call. For example this will only log <code>1</code>:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">let </span><span style="color:#BD976A;">i</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">0</span></span>
<span class="line"><span style="color:#80A665;">setInterval</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#CB7676;">++</span><span style="color:#BD976A;">i</span><span style="color:#666666;">),</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">50</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">runOnlyPendingTimers</span><span style="color:#666666;">()</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">let </span><span style="color:#B07D48;">i</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">0</span></span>
<span class="line"><span style="color:#59873A;">setInterval</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#AB5959;">++</span><span style="color:#B07D48;">i</span><span style="color:#999999;">),</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">50</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">runOnlyPendingTimers</span><span style="color:#999999;">()</span></span></code></pre></div></li></ul><h3 id="vi-runonlypendingtimersasync" tabindex="-1">vi.runOnlyPendingTimersAsync <a class="header-anchor" href="#vi-runonlypendingtimersasync" aria-label="Permalink to &quot;vi.runOnlyPendingTimersAsync&quot;">​</a></h3><ul><li><p><strong>Type:</strong> <code>() =&gt; Promise&lt;Vitest&gt;</code></p><p>This method will asynchronously call every timer that was initiated after <code>vi.useFakeTimers()</code> call, even asynchronous ones. It will not fire any timer that was initiated during its call. For example this will log <code>2, 3, 3, 1</code>:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#80A665;">setTimeout</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">},</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#80A665;">setTimeout</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">Promise</span><span style="color:#666666;">.</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">().</span><span style="color:#80A665;">then</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">2</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">setInterval</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">3</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">},</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">40</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#666666;">},</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">10</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">await</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">runOnlyPendingTimersAsync</span><span style="color:#666666;">()</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">setTimeout</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#59873A;">setTimeout</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">Promise</span><span style="color:#999999;">.</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">().</span><span style="color:#59873A;">then</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#2F798A;">2</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">setInterval</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#2F798A;">3</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">40</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">10</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">await</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">runOnlyPendingTimersAsync</span><span style="color:#999999;">()</span></span></code></pre></div></li></ul><h2 id="vi-setsystemtime" tabindex="-1">vi.setSystemTime <a class="header-anchor" href="#vi-setsystemtime" aria-label="Permalink to &quot;vi.setSystemTime&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>(date: string | number | Date) =&gt; void</code></p><p>Sets current date to the one that was passed. All <code>Date</code> calls will return this date.</p><p>Useful if you need to test anything that depends on the current date - for example <a href="https://github.com/moment/luxon/" target="_blank" rel="noreferrer">luxon</a> calls inside your code.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">date</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> new </span><span style="color:#80A665;">Date</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1998</span><span style="color:#666666;">,</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">11</span><span style="color:#666666;">,</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">19</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">useFakeTimers</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">setSystemTime</span><span style="color:#666666;">(</span><span style="color:#BD976A;">date</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">Date</span><span style="color:#666666;">.</span><span style="color:#80A665;">now</span><span style="color:#666666;">()).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#BD976A;">date</span><span style="color:#666666;">.</span><span style="color:#80A665;">valueOf</span><span style="color:#666666;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">useRealTimers</span><span style="color:#666666;">()</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">date</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> new </span><span style="color:#59873A;">Date</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1998</span><span style="color:#999999;">,</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">11</span><span style="color:#999999;">,</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">19</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">useFakeTimers</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">setSystemTime</span><span style="color:#999999;">(</span><span style="color:#B07D48;">date</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">Date</span><span style="color:#999999;">.</span><span style="color:#59873A;">now</span><span style="color:#999999;">()).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B07D48;">date</span><span style="color:#999999;">.</span><span style="color:#59873A;">valueOf</span><span style="color:#999999;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">useRealTimers</span><span style="color:#999999;">()</span></span></code></pre></div></li></ul><h2 id="vi-setconfig" tabindex="-1">vi.setConfig <a class="header-anchor" href="#vi-setconfig" aria-label="Permalink to &quot;vi.setConfig&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>RuntimeConfig</code></p><p>Updates config for the current test file. You can only affect values that are used, when executing tests.</p></li></ul><h2 id="vi-spyon" tabindex="-1">vi.spyOn <a class="header-anchor" href="#vi-spyon" aria-label="Permalink to &quot;vi.spyOn&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>&lt;T, K extends keyof T&gt;(object: T, method: K, accessType?: &#39;get&#39; | &#39;set&#39;) =&gt; MockInstance</code></p><p>Creates a spy on a method or getter/setter of an object.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">let </span><span style="color:#BD976A;">apples</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4C9A91;">0</span></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">cart</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#80A665;">getApples</span><span style="color:#666666;">: () =&gt; </span><span style="color:#4C9A91;">13</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">spy</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">spyOn</span><span style="color:#666666;">(</span><span style="color:#BD976A;">cart</span><span style="color:#666666;">,</span><span style="color:#CB7676;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">getApples</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">).</span><span style="color:#80A665;">mockImplementation</span><span style="color:#666666;">(()</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">apples</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#BD976A;">apples</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">cart</span><span style="color:#666666;">.</span><span style="color:#80A665;">getApples</span><span style="color:#666666;">()).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">spy</span><span style="color:#666666;">).</span><span style="color:#80A665;">toHaveBeenCalled</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">spy</span><span style="color:#666666;">).</span><span style="color:#80A665;">toHaveReturnedWith</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">let </span><span style="color:#B07D48;">apples</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#2F798A;">0</span></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">cart</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#59873A;">getApples</span><span style="color:#999999;">: () =&gt; </span><span style="color:#2F798A;">13</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">spy</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">spyOn</span><span style="color:#999999;">(</span><span style="color:#B07D48;">cart</span><span style="color:#999999;">,</span><span style="color:#AB5959;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">getApples</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">).</span><span style="color:#59873A;">mockImplementation</span><span style="color:#999999;">(()</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">apples</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#B07D48;">apples</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">cart</span><span style="color:#999999;">.</span><span style="color:#59873A;">getApples</span><span style="color:#999999;">()).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">spy</span><span style="color:#999999;">).</span><span style="color:#59873A;">toHaveBeenCalled</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">spy</span><span style="color:#999999;">).</span><span style="color:#59873A;">toHaveReturnedWith</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span></span></code></pre></div></li></ul><h2 id="vi-stubglobal-1" tabindex="-1">vi.stubGlobal <a class="header-anchor" href="#vi-stubglobal-1" aria-label="Permalink to &quot;vi.stubGlobal&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>(key: keyof globalThis &amp; Window, value: any) =&gt; Vitest</code></p><p>Puts a value on global variable. If you are using <code>jsdom</code> or <code>happy-dom</code>, also puts the value on <code>window</code> object.</p><p>Read more in <a href="/guide/mocking.html#globals">&quot;Mocking Globals&quot; section</a>.</p></li></ul><h2 id="vi-unmock" tabindex="-1">vi.unmock <a class="header-anchor" href="#vi-unmock" aria-label="Permalink to &quot;vi.unmock&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>(path: string) =&gt; void</code></p><p>Removes module from the mocked registry. All calls to import will return the original module even if it was mocked before. This call is hoisted (moved) to the top of the file, so it will only unmock modules that were defined in <code>setupFiles</code>, for example.</p></li></ul><h2 id="vi-dounmock" tabindex="-1">vi.doUnmock <a class="header-anchor" href="#vi-dounmock" aria-label="Permalink to &quot;vi.doUnmock&quot;">​</a></h2><ul><li><p><strong>Type</strong>: <code>(path: string) =&gt; void</code></p><p>The same as <a href="#vi-unmock"><code>vi.unmock</code></a>, but is not hoisted to the top of the file. The next import of the module will import the original module instead of the mock. This will not unmock previously imported modules.</p></li></ul><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// ./increment.js</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">increment</span><span style="color:#666666;">(</span><span style="color:#BD976A;">number</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">number</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// ./increment.js</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">increment</span><span style="color:#999999;">(</span><span style="color:#B07D48;">number</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">number</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">increment</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./increment.js</span><span style="color:#C98A7D99;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// increment is already mocked, because vi.mock is hoisted</span></span>
<span class="line"><span style="color:#80A665;">increment</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// this is hoisted, and factory is called before the import on line 1</span></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">mock</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./increment.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">({ </span><span style="color:#80A665;">increment</span><span style="color:#666666;">: () =&gt; </span><span style="color:#4C9A91;">100</span><span style="color:#666666;"> }))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// all calls are mocked, and `increment` always returns 100</span></span>
<span class="line"><span style="color:#80A665;">increment</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span></span>
<span class="line"><span style="color:#80A665;">increment</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">30</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// this is not hoisted, so other import will return unmocked module</span></span>
<span class="line"><span style="color:#BD976A;">vi</span><span style="color:#666666;">.</span><span style="color:#80A665;">doUnmock</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./increment.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// this STILL returns 100, because `vi.doUnmock` doesn&#39;t reevaluate a module</span></span>
<span class="line"><span style="color:#80A665;">increment</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span></span>
<span class="line"><span style="color:#80A665;">increment</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">30</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// the next import is unmocked, now `increment` is the original function that returns count + 1</span></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#666666;">{</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">increment</span><span style="color:#666666;">:</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">unmockedIncrement</span><span style="color:#CB7676;"> </span><span style="color:#666666;">}</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#4D9375;">await</span><span style="color:#CB7676;"> import</span><span style="color:#666666;">(</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">./increment.js</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">unmockedIncrement</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">2</span></span>
<span class="line"><span style="color:#80A665;">unmockedIncrement</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">30</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">31</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">increment</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./increment.js</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// increment is already mocked, because vi.mock is hoisted</span></span>
<span class="line"><span style="color:#59873A;">increment</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// this is hoisted, and factory is called before the import on line 1</span></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">mock</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./increment.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">({ </span><span style="color:#59873A;">increment</span><span style="color:#999999;">: () =&gt; </span><span style="color:#2F798A;">100</span><span style="color:#999999;"> }))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// all calls are mocked, and `increment` always returns 100</span></span>
<span class="line"><span style="color:#59873A;">increment</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span></span>
<span class="line"><span style="color:#59873A;">increment</span><span style="color:#999999;">(</span><span style="color:#2F798A;">30</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// this is not hoisted, so other import will return unmocked module</span></span>
<span class="line"><span style="color:#B07D48;">vi</span><span style="color:#999999;">.</span><span style="color:#59873A;">doUnmock</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./increment.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// this STILL returns 100, because `vi.doUnmock` doesn&#39;t reevaluate a module</span></span>
<span class="line"><span style="color:#59873A;">increment</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span></span>
<span class="line"><span style="color:#59873A;">increment</span><span style="color:#999999;">(</span><span style="color:#2F798A;">30</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// the next import is unmocked, now `increment` is the original function that returns count + 1</span></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#999999;">{</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">increment</span><span style="color:#999999;">:</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">unmockedIncrement</span><span style="color:#AB5959;"> </span><span style="color:#999999;">}</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#1E754F;">await</span><span style="color:#AB5959;"> import</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">./increment.js</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">unmockedIncrement</span><span style="color:#999999;">(</span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">2</span></span>
<span class="line"><span style="color:#59873A;">unmockedIncrement</span><span style="color:#999999;">(</span><span style="color:#2F798A;">30</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">31</span></span></code></pre></div><h2 id="vi-usefaketimers" tabindex="-1">vi.useFakeTimers <a class="header-anchor" href="#vi-usefaketimers" aria-label="Permalink to &quot;vi.useFakeTimers&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>() =&gt; Vitest</code></p><p>To enable mocking timers, you need to call this method. It will wrap all further calls to timers (such as <code>setTimeout</code>, <code>setInterval</code>, <code>clearTimeout</code>, <code>clearInterval</code>, <code>nextTick</code>, <code>setImmediate</code>, <code>clearImmediate</code>, and <code>Date</code>), until <a href="#vi-userealtimers"><code>vi.useRealTimers()</code></a> is called.</p><p>The implementation is based internally on <a href="https://github.com/sinonjs/fake-timers" target="_blank" rel="noreferrer"><code>@sinonjs/fake-timers</code></a>.</p></li></ul><h2 id="vi-userealtimers" tabindex="-1">vi.useRealTimers <a class="header-anchor" href="#vi-userealtimers" aria-label="Permalink to &quot;vi.useRealTimers&quot;">​</a></h2><ul><li><p><strong>Type:</strong> <code>() =&gt; Vitest</code></p><p>When timers are run out, you may call this method to return mocked timers to its original implementations. All timers that were run before will not be restored.</p></li></ul></div></div></main><footer class="VPDocFooter" data-v-c35479f9 data-v-1b0dba24><!--[--><!--]--><div class="edit-info" data-v-1b0dba24><div class="edit-link" data-v-1b0dba24><a class="VPLink link edit-link-button" href="https://github.com/vitest-dev/vitest/tree/main/docs/api/vi.md" target="_blank" rel="noreferrer" data-v-1b0dba24><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-1b0dba24><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> Suggest changes to this page<!--]--></a></div><div class="last-updated" data-v-1b0dba24><p class="VPLastUpdated" data-v-1b0dba24 data-v-c9c72bcf>Last updated: <time datetime="2023-05-30T08:13:10.000Z" data-v-c9c72bcf></time></p></div></div><div class="prev-next" data-v-1b0dba24><div class="pager" data-v-1b0dba24><a class="pager-link prev" href="/api/mock.html" data-v-1b0dba24><span class="desc" data-v-1b0dba24>Previous page</span><span class="title" data-v-1b0dba24>Mock Functions</span></a></div><div class="has-prev pager" data-v-1b0dba24><a class="pager-link next" href="/api/expect.html" data-v-1b0dba24><span class="desc" data-v-1b0dba24>Next page</span><span class="title" data-v-1b0dba24>Expect</span></a></div></div></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-2db02b50 data-v-9dbfe3d2><div class="container" data-v-9dbfe3d2><p class="message" data-v-9dbfe3d2>Released under the MIT License.</p><p class="copyright" data-v-9dbfe3d2>Copyright © 2021-PRESENT Anthony Fu, Matías Capeletto and Vitest contributors</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"api_assert-type.md\":\"6114acea\",\"advanced_metadata.md\":\"3e143039\",\"advanced_api.md\":\"2d219252\",\"advanced_runner.md\":\"95fc95f2\",\"api_expect-typeof.md\":\"34ac8605\",\"guide_comparisons.md\":\"651d2522\",\"api_mock.md\":\"51389af0\",\"guide_browser.md\":\"93e61da0\",\"guide_common-errors.md\":\"7255fbca\",\"guide_cli.md\":\"8c2fea8f\",\"guide_extending-matchers.md\":\"d6e43e75\",\"guide_ide.md\":\"5c38ec51\",\"guide_coverage.md\":\"a0e48adc\",\"guide_debugging.md\":\"b6297397\",\"guide_filtering.md\":\"7eb1a39d\",\"guide_environment.md\":\"68650635\",\"guide_in-source.md\":\"f002a5d1\",\"guide_features.md\":\"227f7f2e\",\"guide_migration.md\":\"b5834e8b\",\"api_vi.md\":\"f371165e\",\"guide_index.md\":\"7251a795\",\"config_index.md\":\"26a33506\",\"api_index.md\":\"1e672ab4\",\"guide_using-plugins.md\":\"063a50e6\",\"guide_why.md\":\"7dad2c02\",\"guide_ui.md\":\"aafeb36c\",\"index.md\":\"35b46b04\",\"guide_testing-types.md\":\"4fdf6014\",\"guide_snapshot.md\":\"d286b494\",\"guide_workspace.md\":\"7f02605f\",\"guide_test-context.md\":\"7711eb49\",\"api_expect.md\":\"2eff3813\",\"guide_mocking.md\":\"5c961fd1\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Vitest\",\"description\":\"A blazing fast unit test framework powered by Vite\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.svg\",\"editLink\":{\"pattern\":\"https://github.com/vitest-dev/vitest/tree/main/docs/:path\",\"text\":\"Suggest changes to this page\"},\"search\":{\"provider\":\"local\"},\"socialLinks\":[{\"icon\":\"mastodon\",\"link\":\"https://elk.zone/m.webtoo.ls/@vitest\"},{\"icon\":\"twitter\",\"link\":\"https://twitter.com/vitest_dev\"},{\"icon\":\"discord\",\"link\":\"https://chat.vitest.dev\"},{\"icon\":\"github\",\"link\":\"https://github.com/vitest-dev/vitest\"}],\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2021-PRESENT Anthony Fu, Matías Capeletto and Vitest contributors\"},\"nav\":[{\"text\":\"Guide\",\"link\":\"/guide/\",\"activeMatch\":\"^/guide/\"},{\"text\":\"API\",\"link\":\"/api/\",\"activeMatch\":\"^/api/\"},{\"text\":\"Config\",\"link\":\"/config/\",\"activeMatch\":\"^/config/\"},{\"text\":\"Advanced\",\"link\":\"/advanced/api\",\"activeMatch\":\"^/advanced/\"},{\"text\":\"v0.33.0\",\"items\":[{\"text\":\"Release Notes \",\"link\":\"https://github.com/vitest-dev/vitest/releases\"},{\"text\":\"Contributing \",\"link\":\"https://github.com/vitest-dev/vitest/blob/main/CONTRIBUTING.md\"}]}],\"sidebar\":{\"/advanced\":[{\"text\":\"Advanced\",\"items\":[{\"text\":\"Vitest Node API\",\"link\":\"/advanced/api\"},{\"text\":\"Runner API\",\"link\":\"/advanced/runner\"},{\"text\":\"Task Metadata\",\"link\":\"/advanced/metadata\"}]}],\"/\":[{\"text\":\"Guide\",\"items\":[{\"text\":\"Why Vitest\",\"link\":\"/guide/why\"},{\"text\":\"Getting Started\",\"link\":\"/guide/\"},{\"text\":\"Features\",\"link\":\"/guide/features\"},{\"text\":\"Workspace\",\"link\":\"/guide/workspace\"},{\"text\":\"CLI\",\"link\":\"/guide/cli\"},{\"text\":\"Test Filtering\",\"link\":\"/guide/filtering\"},{\"text\":\"Coverage\",\"link\":\"/guide/coverage\"},{\"text\":\"Snapshot\",\"link\":\"/guide/snapshot\"},{\"text\":\"Mocking\",\"link\":\"/guide/mocking\"},{\"text\":\"Testing Types\",\"link\":\"/guide/testing-types\"},{\"text\":\"Vitest UI\",\"link\":\"/guide/ui\"},{\"text\":\"Browser Mode\",\"link\":\"/guide/browser\"},{\"text\":\"In-source Testing\",\"link\":\"/guide/in-source\"},{\"text\":\"Test Context\",\"link\":\"/guide/test-context\"},{\"text\":\"Environment\",\"link\":\"/guide/environment\"},{\"text\":\"Extending Matchers\",\"link\":\"/guide/extending-matchers\"},{\"text\":\"IDE Integration\",\"link\":\"/guide/ide\"},{\"text\":\"Debugging\",\"link\":\"/guide/debugging\"},{\"text\":\"Comparisons\",\"link\":\"/guide/comparisons\"},{\"text\":\"Migration Guide\",\"link\":\"/guide/migration\"},{\"text\":\"Common Errors\",\"link\":\"/guide/common-errors\"}]},{\"text\":\"API\",\"items\":[{\"text\":\"Test API Reference\",\"link\":\"/api/\"},{\"text\":\"Mock Functions\",\"link\":\"/api/mock\"},{\"text\":\"Vi Utility\",\"link\":\"/api/vi\"},{\"text\":\"Expect\",\"link\":\"/api/expect\"},{\"text\":\"ExpectTypeOf\",\"link\":\"/api/expect-typeof\"},{\"text\":\"assertType\",\"link\":\"/api/assert-type\"}]},{\"text\":\"Config\",\"items\":[{\"text\":\"Config Reference\",\"link\":\"/config/\"}]}]}},\"locales\":{\"root\":{\"label\":\"English\",\"lang\":\"en-US\"},\"zh\":{\"label\":\"简体中文\",\"lang\":\"zh\",\"link\":\"https://cn.vitest.dev/\"}},\"scrollOffset\":90,\"cleanUrls\":false}")</script>
    
  </body>
</html>